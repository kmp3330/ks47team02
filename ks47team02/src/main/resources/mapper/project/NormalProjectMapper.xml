<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ks47team02.user.project.normal.mapper.NormalProjectMapper">
	<resultMap  type="NormalProjects" 					id="NormalProjectMap">
		<id 	column="normal_project_code" 			property="normalProjectCode" />
		<result column="user_id" 						property="userId" />
		<result column="normal_project_name" 			property="normalProjectName" />
		<result column="join_cate_code" 				property="joinCateCode" />
		<result column="join_cate_name" 				property="joinCateName" />
		<result column="work_cate_code" 				property="workCateCode" />
		<result column="work_cate_name" 				property="workCateName" />
		<result column="subject_cate_code" 				property="subjectCateCode" />
		<result column="subject_cate_name" 				property="subjectCateName" />
		<result column="required_skill" 				property="requiredSkill" />
		<result column="normal_project_detail" 			property="normalProjectDetail" />
		<result column="project_max_people_num" 		property="projectMaxPeopleNum" />
		<result column="normal_run_code" 				property="normalRunCode" />
		<result column="run_name" 				property="runName" />
		<result column="project_advertise_start_date" 	property="projectAdvertiseStartDate" />
		<result column="project_advertise_finish_date" 	property="projectAdvertiseFinishDate" />
		<result column="project_startup_date" 			property="projectStartUpDate" />
		<result column="project_finish_date" 			property="projectFinishDate" />
		<result column="project_day" 					property="projectDay" />
		<result column="project_day_score" 				property="projectDayScore" />
		<result column="project_finish_score" 			property="projectFinishScore" />
	</resultMap>
	
	<resultMap type="NormalProjects" id="joinCateResultMap">
		<id column="join_cate_code" property="joinCateCode"/>
		<result column="join_cate_name" property="joinCateName"/>
	</resultMap>
	
	<resultMap type="NormalProjects" id="subjectCateResultMap">
		<id column="subject_cate_code" property="subjectCateCode"/>
		<result column="subject_cate_name" property="subjectCateName"/>
	</resultMap>
	
	<resultMap type="NormalProjects" id="workCateResultMap">
		<id column="work_cate_code" property="workCateCode"/>
		<result column="work_cate_name" property="workCateName"/>
	</resultMap>
	
	<insert id="addNormalProject" parameterType="NormalProjects">
		<selectKey resultType="String" keyColumn="newNormalProjectCode" keyProperty="normalProjectCode" order="BEFORE">
			/* 상품 자동 증가 코드 */
			<![CDATA[
			SELECT 
				CASE
				WHEN COUNT(*) = 0 THEN 'normal_project_code_001'
				WHEN CAST(SUBSTRING_INDEX(normal_project_code,'e',-1) AS UNSIGNED) < 999
				THEN CONCAT('e',LPAD(MAX(CAST(SUBSTRING_INDEX(normal_project_code,'e',-1) AS UNSIGNED))+1,3,'0'))	
				ELSE
					CONCAT('e',MAX(CAST(SUBSTRING_INDEX(normal_project_code,'e',-1) AS UNSIGNED))+1)	
				END AS newNormalProjectCode
			FROM 
				normal_project
			]]>
		</selectKey>
		
		
	
		INSERT INTO normal_project
			(normal_project_code, user_id, normal_project_name, join_cate_code, join_cate_name, work_cate_code, work_cate_name, subject_cate_code, subject_cate_name, required_skill, normal_project_detail, project_max_people_num, normal_run_code, run_name, project_advertise_start_date, project_advertise_finish_date, project_startup_date, project_finish_date, project_day, project_day_score, project_finish_score)
		VALUES ("프로젝트코드", 'id001', #{normalProjectName}, #{joinCateCode}, "조인케이트네임", #{workCateCode}, "워크케이트네임", #{subjectCateCode}, "서브젝트네임", #{requiredSkill}, #{normalProjectDetail}, #{projectMaxPeopleNum}, #{normalRunCode}, "런네임", CURDATE(), #{projectAdvertiseFinishDate} ,#{projectStartUpDate}, #{projectFinishDate}, #{projectDay}, 10, 500)
	</insert>
	
	<select id="getNormalProjectList" resultMap="NormalProjectMap">
		/* 회원목록 조회 */
		SELECT 
			normal_project_code, 
			user_id, 
			normal_project_name, 
			join_cate_code, 
			join_cate_name,
			work_cate_code, 
			work_cate_name, 
			subject_cate_code, 
			subject_cate_name, 
			required_skill, 
			normal_project_detail,
			project_max_people_num, 
			normal_run_code, 
			run_name, 
			project_advertise_start_date, 
			project_advertise_finish_date, 
			project_startup_date, 
			project_finish_date, 
			project_day, 
			project_day_score, 
			project_finish_score
		FROM 
			normal_project
	</select>
	
	<select id="getjoinCateList" resultType="joinCate">
		SELECT
			jc.join_cate_code AS joinCateCode,
			jc.join_cate_name AS joinCateName
		FROM
			join_cate AS jc
	</select>
	
	<select id="getSubjectCateList" resultType="subjectCate">
	
		SELECT
			sc.subject_cate_code AS subjectCateCode,
			sc.subject_cate_name AS subjectCateName
		FROM
			subject_cate AS sc
		
	</select>
	<!-- /* 작업분류 리스트 */ -->
	<select id="getWorkCateList" resultType="workCate">
	
		SELECT
			wc.work_cate_code AS workCateCode,
			wc.work_cate_name AS workCateName
		FROM
			work_cate AS wc
		
	</select>
</mapper>