<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{user/banner/layout/default}">
<head>
  <link rel="stylesheet" th:href="@{/user/assets/css/banner.css}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css">
  <link rel="shortcut icon" th:href="@{user/assets/images/logo/favicon.png}" type="image/x-icon">
  <style>
    .card-primary.card-outline {
      border-top: 3px solid #20c997;
    }
    .btn-primary {
      color: #fff;
      background-color: #00adff;
      border-color: #007bff;
      box-shadow: none;
    }
    b, sup, sub, u, del {
      color: #00cf13;
    }
    .genric-btn.primary-border {
      color: #000000;
      border: 1px solid #00000087;
      background: #0000;
    }
    input[type='text'], [type='email'], select, textarea {
      background: none;
      border: none;
      border-bottom: solid 2px #474544;
      color: #474544;
      font-size: 1.000em;
      font-weight: 400;
      letter-spacing: 2px;
      margin: 0 0 0 0;
      padding: 0 0 0 0;
      text-transform: uppercase;
      width: 100%;
      -webkit-box-sizing: border-box;
      -moz-box-sizing: border-box;
      -ms-box-sizing: border-box;
      -o-box-sizing: border-box;
      box-sizing: border-box;
      -webkit-transition: all 0.3s;
      -moz-transition: all 0.3s;
      -ms-transition: all 0.3s;
      -o-transition: all 0.3s;
      transition: all 0.3s;
    }
    .contract {
      width: 700px; margin: 50px auto 80px; padding: 30px 40px 50px;
      border-radius: 30px; background-color: rgb(167, 193, 204);
    }
    .contract h1 {text-align: center;}
    .contract .text {
      height: 230px; border: 1px solid black; background-color: white;
      white-space: pre-line; overflow-y: scroll; margin: 0 auto 20px;
    }
    .contract p {text-align: right;}
    .contract .box {width: 100px; height: 40px;  padding: 8px; margin: 0 3px;}
    .nice-select {
      -webkit-tap-highlight-color: transparent;
      background-color: #00000007;
      width: -webkit-fill-available;
    }
    .margin-bot {
      margin-bottom: 40px;
    }
    .icheck-primary {
      font-family: "Open Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", Helvetica, Arial, sans-serif;
    }
    .custom-select{
      padding-bottom: 2.25rem;
      font-size: 16px;
    }
    .nice-select span.current {
      font-size: 16px;
      display: inline-block;
      line-height: 56px;
    }
    
    input[type='text']:focus, [type='email']:focus, textarea:focus {
      outline: none;
      padding: 0 0 0.875em 0;
    }
  </style>
</head>
<th:block layout:fragment="customContents">
  <div class="row justify-content-center">
    <div class="col-lg-8 card card-outline card-primary">
      <div class="card-header text-center">
        <a href="#" class="h1"><b>ITyranno</b></a>
      </div>
      <div class="card-body">
        <p class="login-box-msg">Register a new membership</p>
        
        <form id="addCompanyForm" th:action="@{/addCompanyMember}" method="post">
          <div class="input-group mb-3">
            <input type="text" id="cpId" name="cpId" class="form-control" placeholder="회원의 아이디를 입력해주세요.">
            <div class="input-group-append">
              <button class="genric-btn primary-border small" id="checkCpId">아이디중복체크</button>
              <div class="input-group-text">
                <span class="fas fa-user"></span>
              </div>
            </div>
          </div>
          <br>
          <div class="input-group mb-3">
            <input type="text" id="cpRegNumber" name="cpRegNumber" class="form-control" placeholder="사업자등록번호를 입력해주세요.">
            <div class="input-group-append">
              <button class="genric-btn primary-border small" id="checkRegNum">사업자등록번호조회</button>
              <div class="input-group-text">
                <span class="fas fa-address-card"></span>
              </div>
            </div>
          </div>
          <br>
          <div class="input-group mb-3">
            <input type="password" id="cpPw" name="cpPw" class="form-control" placeholder="비밀번호를 입력해주세요.">
            <div class="input-group-append">
              <div class="input-group-text">
                <span class="fas fa-lock"></span>
              </div>
            </div>
          </div>
          <div class="input-group mb-3">
            <input type="password" class="form-control" id="cpPwEq" placeholder="비밀번호를 다시 입력해주세요.">
            <div class="input-group-append">
              <div class="input-group-text">
                <span class="fas fa-lock"></span>
              </div>
            </div>
          </div>
          <br><br>
          <div class="input-group mb-3">
            <input type="text" id="cpName" name="cpName" class="form-control" style="text-transform: none" placeholder="기업명을 입력해주세요.">
            <div class="input-group-append">
              <div class="input-group-text">
                <span class="fas fa-user"></span>
              </div>
            </div>
          </div>
          <br><br>
          <div class="input-group mb-3">
            <input type="email" id="cpEmail" name="cpEmail" class="form-control" placeholder="이메일을 입력해주세요.">
            <div class="input-group-append">
              <div class="input-group-text">
                <span class="fas fa-envelope"></span>
              </div>
            </div>
          </div><br><br>
          <div class="input-group mb-3">
            <select class="nice-select" id="cpCate" name="cpCate">
                <option value="" selected disabled>기업의 규모를 선택해주세요.</option>
                <option value="대기업">대기업</option>
                <option value="중견기업">중견기업</option>
                <option value="중소기업">중소기업</option>
                <option value="공기업">공기업</option>
              </select>
          </div>
          <br>
          <div class="input-group mb-3">
            <select class="nice-select" id="areaName" name="areaName">
                <option value="" selected disabled>소재지를 선택해주세요.</option>
                <option value="서울">서울</option>
                <option value="부산">부산</option>
                <option value="대구">대구</option>
                <option value="인천">인천</option>
                <option value="광주">광주</option>
                <option value="울산">울산</option>
                <option value="세종">세종</option>
                <option value="경기">경기</option>
                <option value="강원">강원</option>
                <option value="충북">충북</option>
                <option value="충남">충남</option>
                <option value="전북">전북</option>
                <option value="전남">전남</option>
                <option value="경북">경북</option>
                <option value="경남">경남</option>
                <option value="제주">제주</option>
              </select>
          </div>
          <br>
          <div class="input-group mb-3">
            <input type="address" id="cpAddr" name="cpAddr" class="form-control" placeholder="기업 주소를 입력해주세요.">
            <div class="input-group-append">
              <div class="input-group-text">
                <span class="fas fa-home"></span>
              </div>
            </div>
          </div>
          <br>
          <div class="input-group mb-3">
            <input type="tel" id="cpPhone" name="cpPhone" class="form-control" placeholder="기업 전화 번호를 입력해주세요.">
            <div class="input-group-append">
              <div class="input-group-text">
                <span class="fas fa-phone"></span>
              </div>
            </div>
          </div>
          <br>
          <br>
          <div class="row">
            <div class="col-12">
              <div class="icheck-primary">
                <input type="checkbox" id="terms" name="terms" value="terms">
                <label for="Terms">
                  약관에 따라, 실명 인증된 아이디로 가입, 이벤트・혜택 정보 수신(선택) 동의를 포함합니다.
                </label>
                <button class="genric-btn info-border" type="button" id="readTerms">약관</button>
              </div>
            </div>
            <!-- /.col -->
            <!-- /.col -->
          </div>
          <br><br>
          <button type="submit" id="addCompanyBtn" class="btn btn-primary btn-block" value="회원가입">회원가입</button>
        </form>
        <a th:href="@{/login}" class="text-center">이미 가입된 아이디가 있습니다.</a>
      </div>
      <!-- /.form-box -->
    </div>
  </div>
</th:block>
<th:block layout:fragment="customJs">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
  <script>
    $(document).ready(function (){
      
      let isCpIdChecked = false;
      let isRegNumChecked = false;
      
      function validateForm(){
        // 모든 입력 필드가 채워졌는지 확인
        const allInputs = $(':input:not(:checkbox)');
        let valid = true;
        
        // 약관 동의 체크박스 확인
        if ($('#terms').is(":not(:checked)")) {
          valid = false;
          Swal.fire({
            icon: 'error',
            title: '약관에 동의해주세요'
          });
        }
        
        return valid;
      }
      
      $('#addCompanyForm').submit(function (e){
        if(!validateForm()){
          e.preventDefault();
        }
      });
      
      function isRegNumValid(){
        return $('#cpRegNumber').val().length == 12 && isRegNumChecked;
      }
      $('#checkRegNum').click(function (e){
        e.preventDefault();
        let cpRegNumber = $('#cpRegNumber').val();
        if(cpRegNumber.length != 12){
          Swal.fire({
            icon: 'error',
            title: '사업자등록번호는 (-) 포함 12글자로 이루어져 있습니다.'
          });
        } else {
          $.ajax({
            url: '/checkRegNum',
            type: 'POST',
            data: {cpRegNumber: cpRegNumber},
            success: function (response){
              if(response == true){
                Swal.fire({
                  icon: 'error',
                  title: '이미 등록된 사업자등록번호입니다.'
                });
                isRegNumChecked = false;
              } else {
                Swal.fire({
                  icon: 'success',
                  title: '등록이 가능한 사업자등록번호입니다.'
                });
                isRegNumChecked = true;
              }
            },
            error: function (jqXHR, textStatus, errorThrown) {   // error handling
              console.log(textStatus, errorThrown);
            }
          });
        }
      });
      
      function isCpIdValid(){
        return $('#cpId').val().length >= 5 && isCpIdChecked;
      }
      $('#checkCpId').click(function (e){
        e.preventDefault();
        var cpId = $('#cpId').val();
        if(cpId.length<5){
          Swal.fire({
            icon: 'error',
            title: '아이디는 최소 5글자 이상이어야 합니다.'
          });
        } else {
          $.ajax({
            url: '/checkCpId',
            type: 'POST',
            data: {cpId: cpId},
            success: function (response) {
              if (response == true) {
                Swal.fire({
                  icon: 'error',
                  title: '이미 존재하는 아이디입니다.'
                });
                isCpIdChecked = false;
              } else {
                Swal.fire({
                  icon: 'success',
                  title: '사용 가능한 아이디입니다.'
                })
                isCpIdChecked = true;
              }
            },
            error: function (jqXHR, textStatus, errorThrown) {   // error handling
              console.log(textStatus, errorThrown);
            }
          });
        }
      });
      
      $('#addCompanyForm').submit(function (e){
        if(!isCpIdValid()){
          e.preventDefault();
          Swal.fire({
            icon: 'error',
            title: '아이디 중복체크를 해주세요.'
          })
        }
      });
      $('#addCompanyForm').submit(function (e){
        if(!isRegNumValid()){
          e.preventDefault();
          Swal.fire({
            icon: 'error',
            title: '사업자등록번호를 조회 해주세요.'
          })
        }
      });
      
      $('#addCompanyForm').submit(function (e){
        let pw1 = $('#cpPw').val();
        let pw2 = $('#cpPwEq').val();
        if(pw1 !== pw2){
          e.preventDefault();
          Swal.fire({
            icon: 'error',
            title: '패스워드가 일치하지 않습니다.'
          })
        }
      });
      
      
      $('#addCompanyBtn').click(function (){
        const validateEle = $('#addCompanyBtn input').not('#cpId');
        let isSubmit = false;
        validateEle.each((idx, item) => {
          isSubmit = validCheck(item);
          return isSubmit;
        })
        if(isSubmit) $('#addCompanyForm').submit();
      });
      $('#readTerms').click(function (e){
        e.preventDefault();
        Swal.fire({
          title: '회원가입 약관',
          text: '가. 개인정보의 수집 및 이용 목적\n' +
              ' \n' +
              '                국가공간정보포털은 다음의 목적을 위하여 개인정보를 처리합니다. 처리하고 있는 개인정보는 다음의 목적 이외의 용도로는 이용되지 않으며, 이용 목적이 변경되는 경우에는 개인정보 보호법 제18조에 따라 별도의 동의를 받는 등 필요한 조치를 이행할 예정입니다.\n' +
              '        \n' +
              '                나. 정보주체와 법정대리인의 권리ㆍ의무 및 행사방법\n' +
              '                ① 정보주체(만 14세 미만인 경우에는 법정대리인을 말함)는 언제든지 개인정보 열람·정정·삭제·처리정지 요구 등의 권리를 행사할 수 있습니다.\n' +
              '                ② 제1항에 따른 권리 행사는 개인정보보호법 시행규칙 별지 제8호 서식에 따라 작성 후 서면, 전자우편 등을 통하여 하실 수 있으며, 기관은 이에 대해 지체 없이 조치하겠습니다.\n' +
              '                ③ 제1항에 따른 권리 행사는 정보주체의 법정대리인이나 위임을 받은 자 등 대리인을 통하여 하실 수 있습니다. 이 경우 개인정보 보호법 시행규칙 별지 제11호 서식에 따른 위임장을 제출하셔야 합니다.\n' +
              '                ④ 개인정보 열람 및 처리정지 요구는 개인정보 보호법 제35조 제5항, 제37조 제2항에 의하여 정보주체의 권리가 제한 될 수 있습니다.\n' +
              '                ⑤ 개인정보의 정정 및 삭제 요구는 다른 법령에서 그 개인정보가 수집 대상으로 명시되어 있는 경우에는 그 삭제를 요구할 수 없습니다.\n' +
              '                ⑥ 정보주체 권리에 따른 열람의 요구, 정정ㆍ삭제의 요구, 처리정지의 요구 시 열람 등 요구를 한 자가 본인이거나 정당한 대리인인지를 확인합니다.\n' +
              '                \n' +
              '                다. 수집하는 개인정보의 항목\n' +
              '                국가공간정보포털 회원정보(필수): 이름, 이메일(아이디), 비밀번호\n' +
              '                \n' +
              '                라. 개인정보의 보유 및 이용기간\n' +
              '                국가공간정보포털은 법령에 따른 개인정보 보유ㆍ이용기간 또는 정보주체로부터 개인정보를 수집 시에 동의 받은 개인정보 보유ㆍ이용기간 내에서 개인정보를 처리ㆍ보유합니다.\n' +
              '                \n' +
              '                - 수집근거: 정보주체의 동의\n' +
              '                - 보존기간: 회원 탈퇴 요청 전까지(1년 경과 시 재동의)\n' +
              '                - 보존근거: 정보주체의 동의\n' +
              '                \n' +
              '                마. 동의 거부 권리 및 동의 거부에 따른 불이익\n' +
              '                위 개인정보의 수집 및 이용에 대한 동의를 거부할 수 있으나, 동의를 거부할 경우 회원 가입이 제한됩니다.', // 이곳에 약관 내용을 넣으세요.
          confirmButtonText: '확인',
          showClass: {
            popup: 'animate__animated animate__fadeInDown'
          },
          hideClass: {
            popup: 'animate__animated animate__fadeOutUp'
          }
        })
      })
      
      $('#addCompanyBtn').click(function (e){
        e.preventDefault();  // prevent the form from being submitted
        let isValid = true;
        
        // check each input field to see if it's empty
        $('#addCompanyForm input').each(function() {
          if ($.trim($(this).val()) === '') {
            isValid = false;
          }
        });
        
        // check each select field to see if it's empty
        $('#addCompanyForm select').each(function() {
          if ($.trim($(this).val()) === '') {
            isValid = false;
          }
        });
        
        if (isValid) {
          // if the form is valid, submit it
          $('#addCompanyForm').submit();
        } else {
          Swal.fire({
            icon: 'error',
            title: '모든 항목을 채워주세요.'
          })
        }
      });
    });
  </script>
</th:block>
</html>
