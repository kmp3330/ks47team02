<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{user/layout/default}">

	<th:block layout:fragment="customJs">
		<script>
			$(document).ready(function() {
				$("#acceptBtn").on("click", function() {
					// 여기서 Ajax 요청을 보냅니다.
					$.ajax({
						url: "/normalProject/checkPeople", // Ajax 요청 보낼 URL
						method: "POST", // GET 또는 POST
						data: $("#acceptForm").serialize(), // 폼 데이터를 직렬화하여 전송
						dataType: "json", // 응답 데이터 형식 (JSON 형식으로 응답받을 것이므로 'json'으로 설정)
						success: function(response) {
							// Ajax 요청이 성공적으로 완료되었을 때 실행되는 콜백 함수
							// 서버에서의 유효성 검사 결과를 확인하여, true일 경우 폼을 제출합니다.
							if (response.valid) {
								// 유효성 검사가 통과되었으므로 폼을 제출합니다.
								$("#acceptForm").submit();
							} else {
								// 유효성 검사가 실패하였으므로 사용자에게 오류 메시지를 보여줄 수 있습니다.
								alert("유효성 검사에 실패하였습니다.");
							}
						},
						error: function(xhr, status, error) {
							// Ajax 요청이 실패할 경우 실행되는 콜백 함수
							console.error("Error:", status, error);
						}
					});
				});
				$('#acceptBtn').click(function(){
					const $memberId = $('#memberId');
					let memberId = $memberId.val();

					// 유효성검사
					let valid = validCheck($memberId);
					if(!valid) return false;

					// ajax 호출
					const request = $.ajax({
						url: '/normalProject/checkPeople',
						method: 'POST',
						data: { 'normalProjectCode' : normalProjectCode },
						dataType: 'text'

					});

					request.done(function( response ) {
						if(response == 'true'){
							alert('이미 등록된 아이디입니다.');
							$memberId.val('');
							$memberId.focus();
							return false;
						}else{
							$('#addMemberForm input').prop('disabled', false);
							$('#addMemberForm select').prop('disabled', false);
							$('#addMemberForm button').prop('disabled', false);
						}
						//console.log(response);
					});

					request.fail(function( jqXHR, textStatus ) {
						alert( "Request failed: " + textStatus );
					});

				});
			});







		</script>
	</th:block>
      
	<th:block layout:fragment="customContents">
		<form th:action="@{/normalProject/addApplicantAccept}" method="post" id="addApplicantAcceptForm">
			<section class="jobs-area section-padding">
				<div class="container col-lg-12">
					<div class="row">
						<div class="col-lg-3">
							<div class="sidebar">
								<div class="single-item mb-4">
								</div>
							</div>
						</div>
						<div class="col-lg-9">
							<div class="single-job mb-4 justify-content-between text-center">
								<div class="card">
									<div class="card-header border-0">
										<!-- 제목영역 -->
										<h3 class="mb-0 title_color text-left">일반과제</h3>
										<div class="card-tools">
										</div>
									</div>
									<div class="card-body table-responsive p-0">
										<!-- 테이블영역 -->
										<table class="table table-striped table-valign-middle">
											<thead>
											</thead>
											<form th:action="@{/normalProject/addApplicantAccept}" id="acceptForm" method="post">
												<tbody>
													<tr>
														<td>
															<input type="hidden" name="normalProjectCode" th:value="${normalProjectCode}">
														</td>
														<td>
															<input name="userId" type="hidden" th:value="${loggedInUserId}">
														</td>
														<h1>신청하시겠습니까?</h1>
													</tr>
													<tr>
														<td>
															<button type="button" id="acceptBtn">신청버튼</button>
														</td>
													</tr>
												</tbody>
											</form>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
		</form>
	</th:block>	